<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>F-2-7 비자 점수 & 데이터 저장 시스템</title>
    <style>
        body{font-family:'Noto Sans KR',sans-serif;background:#f0f2f5;padding:20px;}
        .container{max-width:750px;margin:0 auto;background:white;padding:30px;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.1);}
        h2{text-align:center;color:#1a73e8;border-bottom:2px solid #e8f0fe;padding-bottom:10px;}
        .form-group{margin-bottom:15px;}
        label{font-weight:bold;display:block;margin-bottom:8px;}
        select, input{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box;}
        .checkbox-group{background:#f9f9f9;padding:15px;border-radius:8px;border:1px solid #eee;}
        .btn-primary{width:100%;background:#1a73e8;color:white;border:none;padding:15px;font-size:17px;font-weight:bold;border-radius:8px;cursor:pointer;margin-top:20px;}
        .result-box{margin-top:25px;padding:25px;background:#fff;border-radius:10px;text-align:center;border:2px solid #1a73e8;}
        .score-val{font-size:32px;font-weight:bold;color:#1a73e8;}
        .duration-val{font-size:32px;font-weight:bold;color:#e91e63;}
        .hidden{display:none;}
        #statusLabel{font-size:12px; color: #888; margin-top: 5px; text-align: right;}
    </style>
</head>
<body>

<div class="container">
    <div id="intro-section">
        <h2>F-2-7 진단 & 상담 예약</h2>
        <div class="form-group">
            <label>성함</label>
            <input type="text" id="userName" placeholder="홍길동">
        </div>
        <div class="form-group">
            <label>연락처</label>
            <input type="tel" id="userPhone" placeholder="010-1234-5678">
        </div>
        <p style="font-size:12px; color:#666;">* 입력하신 정보는 비자 자격 진단 및 상담 목적으로만 사용됩니다.</p>
        <button class="btn-primary" onclick="startCalculator()">데이터 저장 후 진단 시작</button>
        <div id="statusLabel">데이터 전송 대기 중</div>
    </div>

    <div id="calculator-section" class="hidden">
        <h2>상세 점수 입력</h2>
        
        <div class="form-group">
            <label>1. 나이</label>
            <select id="age" onchange="calculate()">
                <option value="0">선택하세요</option>
                <option value="25">25~29세 (25점)</option>
                <option value="23">18~24세 / 30~34세 (23점)</option>
                <option value="20">35~39세 (20점)</option>
                <option value="12">40~44세 (12점)</option>
                <option value="8">45~50세 (8점)</option>
                <option value="3">51세 이상 (3점)</option>
            </select>
        </div>

        <div class="form-group">
            <label>2. 학력 (이공계/복수학위 로직)</label>
            <select id="edu" onchange="calculate()">
                <option value="0">선택하세요</option>
                <option value="25">박사: 이공계/2개 이상 (25점)</option>
                <option value="20">박사: 이공계 외 (20점)</option>
                <option value="20">석사: 이공계/2개 이상 (20점)</option>
                <option value="17">석사: 이공계 외 (17점)</option>
                <option value="17">학사: 이공계/2개 이상 (17점)</option>
                <option value="15">학사: 이공계 외 (15점)</option>
                <option value="15">전문학사: 이공계 (15점)</option>
                <option value="10">전문학사: 이공계 외 (10점)</option>
            </select>
        </div>

        <div class="form-group">
            <label>3. 한국어 능력</label>
            <select id="lang" onchange="calculate()">
                <option value="0">선택하세요</option>
                <option value="20">5급 이상 (20점)</option>
                <option value="15">4급 (15점)</option>
                <option value="10">3급 (10점)</option>
                <option value="5">2급 (5점)</option>
                <option value="3">1급 (3점)</option>
            </select>
        </div>

        <div class="form-group">
            <label>4. 연간 소득 (체류기간 핵심지표)</label>
            <select id="income" onchange="calculate()">
                <option value="0">선택하세요</option>
                <option value="60">1억원 이상 (60점)</option>
                <option value="50">6천만~7천만원 미만 (50점)</option>
                <option value="45">5천만~6천만원 미만 (45점)</option>
                <option value="40">4천만~5천만원 미만 (40점)</option>
                <option value="30">3천만~4천만원 미만 (30점)</option>
                <option value="10">3천만원 미만 (10점)</option>
            </select>
        </div>

        <div class="form-group">
            <label>5. 가점 항목 (복수 선택, 최대 40점)</label>
            <div class="checkbox-group" id="bonusItems">
                <label><input type="checkbox" value="20" onchange="calculate()"> 정부/참전국 추천 (20점)</label><br>
                <label><input type="checkbox" value="10" onchange="calculate()"> 사회통합 5단계 이수 (10점)</label><br>
                <label><input type="checkbox" value="20" onchange="calculate()"> 국내외 우수대 석사 (20점)</label><br>
                <label><input type="checkbox" value="7" onchange="calculate()"> 국내 사회봉사 3년↑ (7점)</label>
            </div>
        </div>

        <div class="result-box">
            <div style="display:flex; justify-content: space-around;">
                <div>총점: <span class="score-val" id="totalScore">0점</span></div>
                <div>부여기간: <span class="duration-val" id="stayDuration">-</span></div>
            </div>
            <div id="breakdown" style="font-size:12px; color:#888; margin-top:10px;"></div>
        </div>
        
        <button class="btn-primary" onclick="downloadResult()">최종 결과 내려받기 (.txt)</button>
    </div>
</div>

<script>
    // ★★★ 본인의 Google Apps Script URL을 여기에 입력하세요 ★★★
    const SCRIPT_URL = '여기에_스크립트_URL을_넣으세요'; 

    async function startCalculator() {
        const name = document.getElementById('userName').value.trim();
        const phone = document.getElementById('userPhone').value.trim();
        const statusLabel = document.getElementById('statusLabel');

        if(!name || !phone) { 
            alert('성함과 연락처를 모두 입력해 주세요.'); 
            return; 
        }

        // 구글 시트로 데이터 전송
        if(SCRIPT_URL && SCRIPT_URL !== 'https://script.google.com/macros/s/AKfycbyeReI2jTXgh3pzfI_PuUAGK8Wp5ZiMiL1vpnmevPkygk-TjmcXtXDDKsSu7oF1ndLn/exec') {
            statusLabel.innerText = "데이터 저장 중...";
            try {
                const formData = new FormData();
                formData.append('날짜', new Date().toLocaleString());
                formData.append('성함', name);
                formData.append('연락처', phone);

                await fetch(SCRIPT_URL, { method: 'POST', body: formData });
                statusLabel.innerText = "✅ 저장 완료";
            } catch (e) {
                console.error('Error!', e.message);
                statusLabel.innerText = "⚠️ 저장 실패(계산은 가능)";
            }
        }

        // 다음 섹션으로 이동
        document.getElementById('intro-section').classList.add('hidden');
        document.getElementById('calculator-section').classList.remove('hidden');
    }

    function calculate() {
        const age = parseInt(document.getElementById('age').value) || 0;
        const edu = parseInt(document.getElementById('edu').value) || 0;
        const lang = parseInt(document.getElementById('lang').value) || 0;
        const incScore = parseInt(document.getElementById('income').value) || 0;
        
        let bonus = 0;
        const checkboxes = document.querySelectorAll('#bonusItems input[type="checkbox"]');
        checkboxes.forEach(cb => { if(cb.checked) bonus += parseInt(cb.value); });
        if(bonus > 40) bonus = 40;

        const total = age + edu + lang + incScore + bonus;
        
        // 체류기간 로직 적용
        let duration = "-";
        if (total >= 80) {
            if (total >= 139 || incScore >= 50) duration = "5년";
            else if (total >= 120 || incScore >= 45) duration = "3년";
            else if (total >= 110 || incScore >= 30) duration = "2년";
            else duration = "1년";
        } else {
            duration = "대상 아님";
        }

        document.getElementById('totalScore').innerText = total + "점";
        document.getElementById('stayDuration').innerText = duration;
        document.getElementById('breakdown').innerText = `상세: 나이(${age}) 학력(${edu}) 한국어(${lang}) 소득(${incScore}) 가점(${bonus})`;
    }

    function downloadResult() {
        const name = document.getElementById('userName').value;
        const score = document.getElementById('totalScore').innerText;
        const duration = document.getElementById('stayDuration').innerText;
        const content = `[F-2-7 비자 진단 결과]\n성함: ${name}\n총점: ${score}\n예상 체류기간: ${duration}`;
        
        const element = document.createElement('a');
        const file = new Blob([content], {type: 'text/plain'});
        element.href = URL.createObjectURL(file);
        element.download = `F27_진단_${name}.txt`;
        document.body.appendChild(element);
        element.click();
    }
</script>

</body>
</html>
